
.global _t0_reset
.global _t1_reset
.global _t2_reset
.global _t3_reset

_t0_reset:
  .alloc stack_0_bot w 127
  .data stack_0_top w 0xAAAAAAAA
  ldi r15 stack_0_top 
  
  .string test_0_str "Testing thread 0 with a string"
  .alloc test_0_buf b 50
  ldi r4 test_0_str
  ldi r5 test_0_buf
  call string_test
  tstz r0
  skip eq
  jmp test_fail_wait
  jmp test_pass_wait
  
_t1_reset:
  .alloc stack_1_bot w 127
  .data stack_1_top w 0xBBBBBBBB
  ldi r15 stack_1_top
  
  .string test_1_str "This is thread 1 string"
  .alloc test_1_buf b 40
  ldi r4 test_1_str
  ldi r5 test_1_buf
  call string_test
  tstz r0
  skip eq
  jmp test_fail_wait
  jmp test_pass_wait

_t2_reset:
  .alloc stack_2_bot w 127
  .data stack_2_top w 0xCCCCCCCC
  ldi r15 stack_2_top 
  
  .string test_2_str "Thread #2 is going to be the longest string in the test"
  .alloc test_2_buf b 80
  ldi r4 test_2_str
  ldi r5 test_2_buf
  call string_test
  tstz r0
  skip eq
  jmp test_fail_wait
  jmp test_pass_wait
  
_t3_reset:
  .alloc stack_3_bot w 127
  .data stack_3_top w 0xDDDDDDDD
  ldi r15 stack_3_top 
  
  .string test_3_str "The shortest"
  .alloc test_3_buf b 16
  ldi r4 test_3_str
  ldi r5 test_3_buf
  call string_test
  tstz r0
  skip eq
  jmp test_fail_wait
  jmp test_pass_wait

string_test:  
  mv r8 r4
  mv r9 t5
  call strcpy  
  cmpi r0 15 
  skip eq
  mvi r0 1
  \ rtn

  mv r8 r4
  mv r9 t5
  call strcmp  
  cmpi r0 0
  skip eq
  mvi r0 1
  \ rtn

  mv r8 r4
  mv r9 t5
  mvi r2 0x39
  st b r2 r9 [2] 
  call strcmp  
  cmpi r0 0
  skip ne
  mvi r0 1
  \ rtn
  
  mvi r0 0
  \ rtn
  
